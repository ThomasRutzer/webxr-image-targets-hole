(this["webpackJsonpwebxr-image-targets-hole"]=this["webpackJsonpwebxr-image-targets-hole"]||[]).push([[0],{63:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n(1),c=n.n(a),i=n(50),s=n.n(i),o=(n(63),n(11)),u=n.n(o),l=n(16),j=n(9),b=n(44),f=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",createImageBitmap(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(e){return e.close()},d=function(){var e=Object(l.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){f(t).then((function(t){e({image:{image:t,widthInMeters:n},destroy:function(){return p(t)}})})).catch((function(e){return r(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=n(0),h=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getTrackedImageScores());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){},O=function(e,t){var n=e.getImageTrackingResults();if(0!==n.length){var r=e.getPose(n[0].imageSpace,t),a=new m.Vector3,c=new m.Quaternion;return{emulated:"emulated"===n[0].trackingState,measuredWidth:n[0].measuredWidthInMeters,position:a.copy(r.transform.position),rotation:c.copy(r.transform.orientation)}}},x=n(6),v=n(14),w=n(27),y=n(46),S=n(17),k=n(51);var I=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))},M=Object(k.a)((function(e){return{balls:[],addBall:function(){return e((function(e){return{balls:[].concat(Object(S.a)(e.balls),["ball-".concat(I())])}}))},removeBall:function(t){return e((function(e){return{balls:e.balls.filter((function(e){return e!==t}))}}))}}})),R=function(e){var t=Object(v.g)().gl,n=Object(a.useRef)(),r=Object(a.useRef)(),c=Object(a.useCallback)((function(a,i){void 0!==r.current&&e(a,i),r.current=a,n.current=t.xr.getSession().requestAnimationFrame(c)}),[t.xr,e]);Object(a.useEffect)((function(){var e;if((null===(e=t.xr)||void 0===e?void 0:e.isPresenting)||n.current)return n.current=t.xr.getSession().requestAnimationFrame(c),function(){t.xr.getSession().cancelAnimationFrame(c)}}),[t,t.xr.isPresenting,c])},P=function(){var e=Object(a.useMemo)((function(){return{isSupported:!!window.XRImageTrackingResult}}),[]),t=Object(a.useMemo)((function(){return{onSessionStart:h,onSessionEnd:g,onFrameUpdate:O}}),[]),n=Object(a.useState)(),r=Object(j.a)(n,2),c=r[0],i=r[1],s=Object(v.g)().gl,o=Object(b.b)().isPresenting,f=Object(a.useCallback)((function(e,n){var r=t.onFrameUpdate(n,s.xr.getReferenceSpace());i(r)}),[s.xr,t]);return R(f),Object(a.useEffect)((function(){if(e.isSupported&&o){var n=s.xr.getSession();return function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.onSessionStart(n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}()(),function(){t.onSessionEnd(),i(null)}}}),[s.xr,o,t,f,e.isSupported]),c},B=function(){var e=M(),t=Object(w.b)((function(){return{mass:0,position:[0,-2,0],rotation:[-Math.PI/2,0,0],type:"Static",onCollide:function(t){return e.removeBall(t.body.name)}}})),n=Object(j.a)(t,1)[0];return Object(r.jsxs)("mesh",{ref:n,children:[Object(r.jsx)("planeBufferGeometry",{attach:"geometry",args:[5,5]}),Object(r.jsx)("meshStandardMaterial",{opacity:0,transparent:!0,attach:"material",color:"#171717"})]})},F=n(71),L=function(e){var t=Object(F.a)("./hole.glb").nodes,n=t.Cube.geometry,a=n.attributes.position.array,c=n.index.array,i=Object(w.d)((function(){return{mass:0,rotation:e.rotation,args:[a,c]}})),s=Object(j.a)(i,1)[0];return Object(r.jsx)("mesh",Object(x.a)(Object(x.a)({ref:s,geometry:t.Cube.geometry,receiveShadow:!0},e),{},{children:Object(r.jsx)("meshStandardMaterial",{opacity:0,transparent:!0})}))},C=n(43),N=function(e){var t=e.name,n=e.startPos,a=e.opacity,c=Object(v.f)(m.TextureLoader,"/ballMaterial.jpg"),i=Object(w.c)((function(){return{mass:1,position:n,args:.1}})),s=Object(j.a)(i,1)[0];return Object(r.jsxs)(C.a.mesh,{receiveShadow:!0,castShadow:!0,name:t,ref:s,children:[Object(r.jsx)("sphereBufferGeometry",{attach:"geometry",args:[.1,64,64]}),Object(r.jsx)(C.a.meshBasicMaterial,{transparent:!0,opacity:a,attach:"material",map:c})]})},E=function(e,t){var n=e+(t-e)*Math.random();return Number(n.toFixed(1))};var T=function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e})),Object(a.useEffect)((function(){if(null!==t){var e=setInterval((function(){"undefined"!==typeof(null===n||void 0===n?void 0:n.current)&&(null===n||void 0===n||n.current())}),t);return function(){return clearInterval(e)}}}),[t])};var A=function(){var e=P(),t=Object(a.useRef)(),n=M(),c=Object(v.g)().gl;T((function(){c.xr.isPresenting&&n.addBall()}),c.xr.isPresenting?3e3:null);var i=Object(y.useTransition)(n.balls,{keys:function(e){return e},from:{opacity:0},enter:{opacity:1},leave:{opacity:0}},[n.balls.length]),s=Object(j.a)(i,1)[0];return Object(v.e)((function(){c.xr.isPresenting&&!(null===e||void 0===e?void 0:e.emulated)?e&&(t.current.visible=!0,t.current.position.copy(e.position),t.current.rotation.copy(e.rotation)):t.current.visible=!1})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("hemisphereLight",{intensity:.35}),Object(r.jsx)(w.a,{children:Object(r.jsxs)("group",{ref:t,children:[Object(r.jsx)("spotLight",{position:[30,0,30],angle:.3,penumbra:1,intensity:2,castShadow:!0,"shadow-mapSize-width":256,"shadow-mapSize-height":256}),Object(r.jsx)("pointLight",{position:[-30,0,-30],intensity:.5}),Object(r.jsxs)("group",{scale:[.07,.07,.07],children:[Object(r.jsx)(B,{}),Object(r.jsx)(L,{rotation:[0,0,0]}),s((function(e,t){return Object(r.jsx)(N,Object(x.a)(Object(x.a)(Object(x.a)({},t),e),{},{name:t,startPos:[E(-1,1),9,E(-1,1)]}))}))]})]})})]})};var q=function(){var e=Object(a.useRef)(),t=Object(a.useState)(),n=Object(j.a)(t,2),c=n[0],i=n[1],s=function(){var t=Object(l.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d(e.current,.12);case 3:n=t.sent,i(n.image),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"intro",children:[Object(r.jsxs)("section",{children:[Object(r.jsx)("h1",{className:"title",children:"WebXR Image Target \u2013 Hole \ud83d\udd73\ufe0f"}),Object(r.jsx)("img",{className:"trackedImage",onLoad:function(){return s()},alt:"is cool",ref:e,src:"/webxr-image-targets-hole/trackedImage.jpg"})]}),Object(r.jsx)("section",{children:Object(r.jsxs)("ol",{className:"explanation",children:[Object(r.jsxs)("li",{children:[Object(r.jsxs)("button",{onClick:function(){return window.print()},children:["Print image",Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"#e2e2e2",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"arcs",children:Object(r.jsx)("path",{d:"M7 17l9.2-9.2M17 17V7H7"})})]}),"  10cm x 10cm"]}),Object(r.jsx)("li",{children:"Start AR"}),Object(r.jsx)("li",{children:"Scan image on flat surface"})]})}),Object(r.jsxs)("section",{children:[Object(r.jsx)("hr",{}),Object(r.jsxs)("small",{className:"compatibility",children:["Currently only available in Chrome for Android >=89, with flag ",Object(r.jsx)("span",{className:"snippet",children:"chrome://flags#webxr-incubations"})," active"]}),Object(r.jsxs)("small",{className:"credit",children:["by ",Object(r.jsxs)("a",{href:"https://thomasrutzer@github.io",target:"blank",children:["Thomas Rutzer",Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"arcs",children:Object(r.jsx)("path",{d:"M7 17l9.2-9.2M17 17V7H7"})})]})]})]})]}),c&&Object(r.jsx)(b.a,{style:{position:"absolute",left:0,top:0},camera:{position:[5,10,0]},sessionInit:{requiredFeatures:["image-tracking"],trackedImages:[c]},children:Object(r.jsx)(A,{})})]})};s.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(q,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.1e341b6f.chunk.js.map